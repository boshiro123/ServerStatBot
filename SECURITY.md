# üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Server Monitor Bot

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**Dockerfile:**

- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä app –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `appuser` (UID 1000), –∞ –Ω–µ –æ—Ç root
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ä–∏—Å–∫ –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ capabilities (Linux capabilities)

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `app`:**

```yaml
cap_drop:
  - ALL # –£–±–∏—Ä–∞–µ–º –≤—Å–µ capabilities
cap_add:
  - SYS_PTRACE # –¢–æ–ª—å–∫–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `db`:**

```yaml
cap_drop:
  - ALL
cap_add:
  - CHOWN # –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏ —Ñ–∞–π–ª–æ–≤
  - DAC_OVERRIDE # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
  - SETGID # –î–ª—è —Å–º–µ–Ω—ã –≥—Ä—É–ø–ø—ã
  - SETUID # –î–ª—è —Å–º–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `adminer`:**

```yaml
cap_drop:
  - ALL
cap_add:
  - CHOWN
  - SETGID
  - SETUID
  - NET_BIND_SERVICE # –î–ª—è –±–∏–Ω–¥–∏–Ω–≥–∞ –ø–æ—Ä—Ç–∞
```

### 3. Security Options

**–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**

```yaml
security_opt:
  - no-new-privileges:true # –ó–∞–ø—Ä–µ—Ç –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
```

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SUID/SGID –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤ –¥–ª—è —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π.

### 4. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

**PostgreSQL –∏ Adminer:**

```yaml
ports:
  - "127.0.0.1:5433:5432" # –¢–æ–ª—å–∫–æ localhost
  - "127.0.0.1:8080:8080" # –¢–æ–ª—å–∫–æ localhost
```

- –î–æ—Å—Ç—É–ø –∫ –ë–î –∏ Adminer **—Ç–æ–ª—å–∫–æ —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞**
- –ò–∑–≤–Ω–µ –ø–æ—Ä—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- –î–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH —Ç—É–Ω–Ω–µ–ª—å

### 5. Read-only –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**

```yaml
volumes:
  - /proc:/host/proc:ro # read-only
  - /sys:/host/sys:ro # read-only
```

- –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ö–æ—Å—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

**Adminer:**

```yaml
read_only: true # –í–µ—Å—å filesystem read-only
tmpfs:
  - /tmp:noexec,nosuid,size=50m # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ tmpfs
```

### 6. –ó–∞—â–∏—â—ë–Ω–Ω—ã–π tmpfs

**–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**

```yaml
tmpfs:
  - /tmp:noexec,nosuid,size=100m
```

- `noexec` ‚Äî –∑–∞–ø—Ä–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ /tmp
- `nosuid` ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ SUID –±–∏—Ç–∞
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞

### 7. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (DoS protection)

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `app`:**

```yaml
resources:
  limits:
    cpus: "1.0" # –ú–∞–∫—Å–∏–º—É–º 1 CPU
    memory: 512M # –ú–∞–∫—Å–∏–º—É–º 512 –ú–ë RAM
  reservations:
    cpus: "0.25" # –ú–∏–Ω–∏–º—É–º 0.25 CPU
    memory: 128M # –ú–∏–Ω–∏–º—É–º 128 –ú–ë RAM
```

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `db`:**

```yaml
resources:
  limits:
    cpus: "1.0"
    memory: 512M
```

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `adminer`:**

```yaml
resources:
  limits:
    cpus: "0.5"
    memory: 256M
```

### 8. Healthchecks

**PostgreSQL:**

```yaml
healthcheck:
  test: ["CMD-SHELL", "pg_isready -U postgres"]
  interval: 10s
  timeout: 5s
  retries: 5
```

**App (–≤ Dockerfile):**

```dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
    CMD python -c "import sys; sys.exit(0)"
```

### 9. –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Ç—å

```yaml
networks:
  default:
    name: serverstat_network
```

- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–≤–æ–µ–π —Å–µ—Ç–∏
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –¥—Ä—É–≥–∏–º Docker —Å–µ—Ç—è–º

### 10. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑

```dockerfile
FROM python:3.11-slim
```

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è slim –≤–µ—Ä—Å–∏—è (–º–µ–Ω—å—à–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π)
- –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## –í–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫ –∏ –∑–∞—â–∏—Ç–∞

### ‚ö†Ô∏è –í–µ–∫—Ç–æ—Ä 1: –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö

**–ó–∞—â–∏—Ç–∞:**

- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip install --upgrade`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫–∞–Ω–µ—Ä—ã —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π: `pip-audit` –∏–ª–∏ `safety`
- ‚úÖ –§–∏–∫—Å–∏—Ä—É–π—Ç–µ –≤–µ—Ä—Å–∏–∏ –≤ `requirements.txt`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```bash
pip install pip-audit
pip-audit -r requirements.txt
```

### ‚ö†Ô∏è –í–µ–∫—Ç–æ—Ä 2: –ò–Ω—ä–µ–∫—Ü–∏—è —á–µ—Ä–µ–∑ Telegram –∫–æ–º–∞–Ω–¥—ã

**–ó–∞—â–∏—Ç–∞:**

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTML parse mode (–Ω–µ Markdown)
- ‚úÖ –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥ –ø–∞—Ä—Å—è—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ

### ‚ö†Ô∏è –í–µ–∫—Ç–æ—Ä 3: SQL Injection

**–ó–∞—â–∏—Ç–∞:**

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLAlchemy ORM (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- ‚úÖ –ù–µ—Ç raw SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### ‚ö†Ô∏è –í–µ–∫—Ç–æ—Ä 4: –≠—Å–∫–∞–ª–∞—Ü–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

**–ó–∞—â–∏—Ç–∞:**

- ‚úÖ `no-new-privileges:true` ‚Äî –∑–∞–ø—Ä–µ—Ç –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- ‚úÖ –ó–∞–ø—É—Å–∫ –æ—Ç –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ capabilities

### ‚ö†Ô∏è –í–µ–∫—Ç–æ—Ä 5: –í—ã—Ö–æ–¥ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (container breakout)

**–ó–∞—â–∏—Ç–∞:**

- ‚úÖ `pid: "host"` –Ω—É–∂–µ–Ω –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –Ω–æ —Ä–∏—Å–∫ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω:
  - Read-only –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ /proc –∏ /sys
  - –ó–∞–ø—Ä–µ—Ç –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
  - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ capabilities (—Ç–æ–ª—å–∫–æ SYS_PTRACE)
- ‚úÖ –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `privileged: true`

### ‚ö†Ô∏è –í–µ–∫—Ç–æ—Ä 6: DoS —á–µ—Ä–µ–∑ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

**–ó–∞—â–∏—Ç–∞:**

- ‚úÖ –ñ—ë—Å—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã CPU –∏ RAM
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ tmpfs
- ‚úÖ Restart –ø–æ–ª–∏—Ç–∏–∫–∞: `unless-stopped`

### ‚ö†Ô∏è –í–µ–∫—Ç–æ—Ä 7: –£—Ç–µ—á–∫–∞ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞

**–ó–∞—â–∏—Ç–∞:**

- ‚úÖ –¢–æ–∫–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ –∫–æ–¥–µ)
- ‚úÖ `.env` –≤ `.gitignore`
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker secrets –≤ production

### ‚ö†Ô∏è –í–µ–∫—Ç–æ—Ä 8: –ê—Ç–∞–∫–∞ –Ω–∞ PostgreSQL –∏–∑–≤–Ω–µ

**–ó–∞—â–∏—Ç–∞:**

- ‚úÖ –ü–æ—Ä—Ç –ø—Ä–∏–≤—è–∑–∞–Ω —Ç–æ–ª—å–∫–æ –∫ localhost
- ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è Docker —Å–µ—Ç—å
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è SSH —Ç—É–Ω–Ω–µ–ª—å –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### ‚ö†Ô∏è –í–µ–∫—Ç–æ—Ä 9: –ê—Ç–∞–∫–∞ –Ω–∞ Adminer

**–ó–∞—â–∏—Ç–∞:**

- ‚úÖ –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å localhost
- ‚úÖ Read-only filesystem
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –æ—Ç–∫–ª—é—á–∞–π—Ç–µ –≤ production –∏–ª–∏ –∑–∞—â–∏—Ç–∏—Ç–µ nginx —Å basic auth

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production

### 1. –û—Ç–∫–ª—é—á–∏—Ç–µ Adminer

–í production —Å—Ä–µ–¥–µ –æ—Ç–∫–ª—é—á–∏—Ç–µ Adminer –∏–ª–∏ –∑–∞—â–∏—Ç–∏—Ç–µ –µ–≥–æ:

```yaml
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ docker-compose.yml
# adminer:
#   ...
```

–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ nginx —Å basic auth –ø–µ—Ä–µ–¥ –Ω–∏–º.

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Secrets

–í–º–µ—Å—Ç–æ `.env` —Ñ–∞–π–ª–∞:

```yaml
secrets:
  telegram_token:
    external: true

services:
  app:
    secrets:
      - telegram_token
```

### 3. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–∑—ã

```bash
docker-compose pull
docker-compose build --no-cache
docker-compose up -d
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

```bash
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
docker-compose logs --tail=100 -f | grep -i error
```

### 5. Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
docker exec serverstat_db pg_dump -U postgres metrics > backup.sql
```

### 6. –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤

–î–æ–±–∞–≤—å—Ç–µ —Ä–æ—Ç–∞—Ü–∏—é –¥–ª—è `logs/bot.log`:

```bash
# /etc/logrotate.d/serverstat
/path/to/ServerStat/logs/*.log {
    daily
    rotate 7
    compress
    missingok
    notifempty
}
```

### 7. Firewall –ø—Ä–∞–≤–∏–ª–∞

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç–µ —Ç–æ–ª—å–∫–æ SSH –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
ufw default deny incoming
ufw default allow outgoing
ufw allow ssh
ufw enable
```

### 8. SSH —Ç—É–Ω–Ω–µ–ª—å –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ PostgreSQL/Adminer —É–¥–∞–ª—ë–Ω–Ω–æ:

```bash
ssh -L 5433:localhost:5433 -L 8080:localhost:8080 user@server
```

–¢–µ–ø–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ http://localhost:8080 –ª–æ–∫–∞–ª—å–Ω–æ.

### 9. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

```bash
# Trivy - —Å–∫–∞–Ω–µ—Ä Docker –æ–±—Ä–∞–∑–æ–≤
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  aquasec/trivy image serverstat_app

# pip-audit - —Å–∫–∞–Ω–µ—Ä Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install pip-audit
pip-audit
```

### 10. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µroot –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Ö–æ—Å—Ç–µ

```bash
# –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ docker-compose –æ—Ç root
sudo usermod -aG docker $USER
newgrp docker
docker-compose up -d
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ß–µ–∫–ª–∏—Å—Ç

- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ—Ç –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –í—Å–µ sensitive –¥–∞–Ω–Ω—ã–µ –≤ `.env`, –∫–æ—Ç–æ—Ä—ã–π –≤ `.gitignore`
- [ ] –ü–æ—Ä—Ç—ã –ë–î –∏ Adminer –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Å localhost
- [ ] Capabilities –º–∏–Ω–∏–º–∞–ª—å–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- [ ] `no-new-privileges:true` –≤–∫–ª—é—á—ë–Ω
- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Healthchecks —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –õ–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä—è—Ç—Å—è
- [ ] Backup –ë–î –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

### –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```bash
# Docker Bench Security
docker run --rm --net host --pid host --userns host --cap-add audit_control \
  -v /var/lib:/var/lib -v /var/run/docker.sock:/var/run/docker.sock \
  docker/docker-bench-security

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ capabilities
docker inspect serverstat_bot | grep -A 20 CapAdd
```

---

## –ß—Ç–æ –ù–ï –∑–∞—â–∏—â–µ–Ω–æ

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

1. **`pid: "host"`** ‚Äî –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–æ—Ü–µ—Å—Å–∞–º —Ö–æ—Å—Ç–∞

   - **–†–∏—Å–∫**: —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–µ–Ω container breakout
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ capabilities, read-only –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞**: –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–±–µ–∑ —Ö–æ—Å—Ç–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫)

2. **–¢–æ–∫–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è**

   - **–†–∏—Å–∫**: –≤–∏–¥–∏–º —á–µ—Ä–µ–∑ `docker inspect`
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Secrets –≤ production

3. **–ù–µ—Ç SSL –¥–ª—è PostgreSQL**
   - **–†–∏—Å–∫**: —Ç—Ä–∞—Ñ–∏–∫ –≤ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: Docker —Å–µ—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å SSL

---

## –ò—Ç–æ–≥–∏ —É–ª—É—á—à–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

‚úÖ **10+ –º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**
‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏**
‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**
‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∞—Ç–∞–∫**

**–ë–∞–ª–∞–Ω—Å**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ**: 2025-10-05
